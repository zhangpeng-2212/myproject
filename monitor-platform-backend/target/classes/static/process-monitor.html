<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›‘æ§å¹³å° - è¿›ç¨‹ç®¡ç†</title>
    <link rel="stylesheet" href="styles.css?v=1.1">
    <script src="common.js?v=1.1"></script>
    <script src="process-monitor.js?v=1.2"></script>
</head>
<body>
<div class="app-container">
    <header class="app-header">
        <h1>ç›‘æ§å¹³å°</h1>
        <p>è¿›ç¨‹ç®¡ç† Â· çŠ¶æ€ç›‘æ§ Â· èµ„æºåˆ†æ</p>
    </header>

    <main class="app-main">
        <nav class="nav-links">
            <!-- <a href="dashboard.html">ç›‘æ§å¤§å±</a> -->
            <!-- <a href="index.html">æœåŠ¡ç›‘æ§</a> -->
            <a href="server.html">æœåŠ¡å™¨ç®¡ç†</a>
            <a href="process-monitor.html" class="active">è¿›ç¨‹ç®¡ç†</a>
            <!-- <a href="chat.html">æ™ºèƒ½é—®ç­”</a> -->
        </nav>

        <section class="content">
            <!-- ç»Ÿè®¡æ‘˜è¦ -->
            <div class="stats-summary" id="stats-summary">
                <div class="stat-card">
                    <div class="stat-value" id="stat-total">0</div>
                    <div class="stat-label">æ€»è¿›ç¨‹æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-running">0</div>
                    <div class="stat-label">è¿è¡Œä¸­</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-stopped">0</div>
                    <div class="stat-label">å·²åœæ­¢</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-error">0</div>
                    <div class="stat-label">å¼‚å¸¸</div>
                </div>
            </div>

            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>è¿›ç¨‹åˆ—è¡¨</h2>
                    <div style="display: flex; gap: 10px;">
                        <select id="filter-server" onchange="loadProcesses()">
                            <option value="">æ‰€æœ‰æœåŠ¡å™¨</option>
                        </select>
                        <select id="filter-status" onchange="loadProcesses()">
                            <option value="">æ‰€æœ‰çŠ¶æ€</option>
                            <option value="running">è¿è¡Œä¸­</option>
                            <option value="stopped">å·²åœæ­¢</option>
                            <option value="error">å¼‚å¸¸</option>
                        </select>
                        <button onclick="showAddProcessModal()">æ·»åŠ è¿›ç¨‹</button>
                    </div>
                </div>

                <div id="process-list" class="process-grid"></div>

                <div id="empty-state" style="text-align: center; padding: 60px 20px; color: #999; display: none;">
                    <p>æš‚æ— è¿›ç¨‹ï¼Œç‚¹å‡»"æ·»åŠ è¿›ç¨‹"å¼€å§‹åˆ›å»º</p>
                </div>
            </div>
        </section>
    </main>
</div>

<!-- æ·»åŠ è¿›ç¨‹å¼¹çª— -->
<div class="modal-overlay" id="add-process-modal">
    <div class="modal">
        <h2>æ·»åŠ è¿›ç¨‹</h2>
        <form class="modal-form" id="add-process-form">
            <label>
                è¿›ç¨‹åç§°
                <input type="text" id="process-name" required>
            </label>
            <label>
                æ‰€å±æœåŠ¡å™¨
                <select id="process-server" required>
                    <option value="">è¯·é€‰æ‹©æœåŠ¡å™¨</option>
                </select>
            </label>
            <label>
                è¿›ç¨‹ç±»å‹
                <select id="process-type" required>
                    <option value="app">åº”ç”¨è¿›ç¨‹</option>
                    <option value="database">æ•°æ®åº“è¿›ç¨‹</option>
                    <option value="cache">ç¼“å­˜è¿›ç¨‹</option>
                    <option value="system">ç³»ç»Ÿè¿›ç¨‹</option>
                    <option value="other">å…¶ä»–è¿›ç¨‹</option>
                </select>
            </label>
            <label>
                ç«¯å£ï¼ˆå¤šä¸ªç«¯å£ç”¨é€—å·åˆ†éš”ï¼‰
                <input type="text" id="process-ports" placeholder="ä¾‹å¦‚: 8080,8081">
            </label>
            <label>
                å¯åŠ¨å‘½ä»¤
                <input type="text" id="process-start-cmd" placeholder="ä¾‹å¦‚: /usr/bin/java -jar app.jar">
            </label>
            <label>
                åœæ­¢å‘½ä»¤
                <input type="text" id="process-stop-cmd" placeholder="ä¾‹å¦‚: /usr/bin/kill -15 ${PID}">
            </label>
            <label>
                æè¿°
                <textarea id="process-desc" rows="2"></textarea>
            </label>
            <label>
                <input type="checkbox" id="process-autostart" checked> è‡ªåŠ¨å¯åŠ¨
            </label>
            <div class="modal-actions">
                <button type="button" onclick="hideAddProcessModal()">å–æ¶ˆ</button>
                <button type="submit">ä¿å­˜</button>
            </div>
        </form>
    </div>
</div>

<!-- è¿›ç¨‹è¯¦æƒ…å¼¹çª— -->
<div class="modal-overlay" id="process-detail-modal">
    <div class="modal large-modal">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 id="detail-process-name">è¿›ç¨‹è¯¦æƒ…</h2>
            <button onclick="hideDetailModal()" style="padding: 6px 12px;">å…³é—­</button>
        </div>
        <div id="process-detail-content"></div>
    </div>
</div>

<!-- çº¿ç¨‹åˆ—è¡¨å¼¹çª— -->
<div class="modal-overlay" id="thread-list-modal">
    <div class="modal large-modal">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div>
                <h2 id="thread-list-title">çº¿ç¨‹ç›‘æ§</h2>
                <div id="thread-stats" style="margin-top: 10px; font-size: 13px; color: #666;"></div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button onclick="generateHotspotTestData()" style="padding: 6px 12px;">ğŸ“Š ç”Ÿæˆæµ‹è¯•æ•°æ®</button>
                <button onclick="analyzeHotspots()" style="padding: 6px 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">ğŸ” AIçƒ­ç‚¹åˆ†æ</button>
                <button onclick="collectThreadData()" style="padding: 6px 12px;">é‡‡é›†æ•°æ®</button>
                <button onclick="hideThreadModal()" style="padding: 6px 12px;">å…³é—­</button>
            </div>
        </div>
        <div style="margin-bottom: 15px; display: flex; gap: 10px;">
            <select id="filter-thread-state" onchange="filterThreads()">
                <option value="">æ‰€æœ‰çŠ¶æ€</option>
                <option value="RUNNABLE">è¿è¡Œä¸­</option>
                <option value="WAITING">ç­‰å¾…</option>
                <option value="TIMED_WAITING">é™æ—¶ç­‰å¾…</option>
                <option value="BLOCKED">é˜»å¡</option>
            </select>
        </div>
        <div id="thread-list" style="max-height: 500px; overflow-y: auto;"></div>
    </div>
</div>

<!-- çº¿ç¨‹å †æ ˆå¼¹çª— -->
<div class="modal-overlay" id="thread-stack-modal">
    <div class="modal large-modal">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 id="thread-stack-title">çº¿ç¨‹å †æ ˆ</h2>
            <button onclick="hideStackModal()" style="padding: 6px 12px;">å…³é—­</button>
        </div>
        <div id="thread-stack-content" style="max-height: 600px; overflow-y: auto;"></div>
    </div>
</div>

<!-- AIçƒ­ç‚¹åˆ†æç»“æœå¼¹çª— -->
<div class="modal-overlay" id="hotspot-analysis-modal">
    <div class="modal large-modal hotspot-modal" style="max-width: 1100px; display: flex; flex-direction: column;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-shrink: 0; padding-bottom: 15px; border-bottom: 2px solid #e8e8e8;">
            <div>
                <h2 style="display: flex; align-items: center; gap: 8px; margin: 0; font-size: 22px; color: #333;">
                    <span>ğŸ”</span>
                    <span>çº¿ç¨‹çƒ­ç‚¹AIåˆ†æ</span>
                </h2>
                <div id="hotspot-summary" style="margin-top: 8px; font-size: 14px; color: #666; font-weight: 500;"></div>
            </div>
            <button onclick="hideHotspotModal()" class="modal-close-btn" style="padding: 10px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3); transition: all 0.3s ease;">å…³é—­</button>
        </div>

        <div id="hotspot-analysis-content" class="hotspot-content" style="flex: 1; overflow-y: auto; padding-right: 10px;">
            <!-- å¥åº·è¯„åˆ†å¡ç‰‡ -->
            <div id="health-score-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 25px; text-align: center; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                <div style="font-size: 16px; margin-bottom: 8px; opacity: 0.95;">ç³»ç»Ÿå¥åº·è¯„åˆ†</div>
                <div id="health-score-value" style="font-size: 56px; font-weight: bold; margin-bottom: 5px;">0</div>
                <div id="health-score-label" style="font-size: 16px; opacity: 0.95; font-weight: 500;"></div>
            </div>

            <!-- çƒ­ç‚¹é—®é¢˜ç»Ÿè®¡ -->
            <div id="hotspot-stats" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px;">
                <div style="background: #fff5f5; padding: 15px; border-radius: 8px; border-left: 4px solid #ff4d4f;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">ä¸¥é‡é—®é¢˜</div>
                    <div id="stat-critical" style="font-size: 24px; font-weight: bold; color: #ff4d4f;">0</div>
                </div>
                <div style="background: #fff7e6; padding: 15px; border-radius: 8px; border-left: 4px solid #fa8c16;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">é«˜ä¼˜å…ˆçº§</div>
                    <div id="stat-high" style="font-size: 24px; font-weight: bold; color: #fa8c16;">0</div>
                </div>
                <div style="background: #fffbe6; padding: 15px; border-radius: 8px; border-left: 4px solid #faad14;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">ä¸­ä¼˜å…ˆçº§</div>
                    <div id="stat-medium" style="font-size: 24px; font-weight: bold; color: #faad14;">0</div>
                </div>
                <div style="background: #f0f5ff; padding: 15px; border-radius: 8px; border-left: 4px solid #597ef7;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">æ€»çƒ­ç‚¹æ•°</div>
                    <div id="stat-total" style="font-size: 24px; font-weight: bold; color: #597ef7;">0</div>
                </div>
            </div>

            <!-- çƒ­ç‚¹æ–¹æ³•åˆ—è¡¨ -->
            <div style="margin-bottom: 20px;">
                <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #333; font-weight: 600;">ğŸ”¥ çƒ­ç‚¹æ–¹æ³•è¯¦æƒ…</h3>
                <div id="hotspot-list" style="display: flex; flex-direction: column; gap: 12px;"></div>
            </div>

            <!-- åˆ†æè¯´æ˜ -->
            <div style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 8px; font-size: 13px; color: #666;">
                <strong style="color: #333; font-size: 14px;">ğŸ“Š åˆ†æè¯´æ˜ï¼š</strong>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li><strong>çƒ­ç‚¹æ–¹æ³•</strong>ï¼šåœ¨æ‰€æœ‰çº¿ç¨‹å †æ ˆä¸­å‡ºç°é¢‘ç‡æœ€é«˜çš„æ–¹æ³•ï¼Œå¯èƒ½å½±å“ç³»ç»Ÿæ€§èƒ½</li>
                    <li><strong>ä¸¥é‡çº§åˆ«</strong>ï¼šâ­â­â­â­â­ (5-æœ€ä¸¥é‡, 1-è½»å¾®)</li>
                    <li><strong>å¥åº·è¯„åˆ†</strong>ï¼š80-100è‰¯å¥½, 60-79ä¸€èˆ¬, 0-59éœ€å…³æ³¨</li>
                    <li><strong>ä¼˜åŒ–å»ºè®®</strong>ï¼šæ¯ä¸ªçƒ­ç‚¹éƒ½æä¾›é’ˆå¯¹æ€§çš„ä¼˜åŒ–å»ºè®®ï¼Œè¯·ä¼˜å…ˆå¤„ç†é«˜ä¸¥é‡çº§åˆ«é—®é¢˜</li>
                </ul>
            </div>
        </div>

        <div id="hotspot-loading" style="display: none; text-align: center; padding: 60px; flex-shrink: 0;">
            <div style="font-size: 48px; margin-bottom: 15px; animation: spin 1s linear infinite;">ğŸ”„</div>
            <div style="font-size: 16px; color: #666;">AIæ­£åœ¨åˆ†æçº¿ç¨‹æ•°æ®...</div>
            <div style="font-size: 13px; color: #999; margin-top: 10px;">è¯·ç¨å€™</div>
        </div>

        <div id="hotspot-empty" style="display: none; text-align: center; padding: 60px; flex-shrink: 0;">
            <div style="font-size: 64px; margin-bottom: 20px;">ğŸ“­</div>
            <div style="font-size: 18px; color: #666; margin-bottom: 10px;">æš‚æ— çº¿ç¨‹æ•°æ®</div>
            <div style="font-size: 14px; color: #999;">è¯·å…ˆç‚¹å‡»"ç”Ÿæˆæµ‹è¯•æ•°æ®"æˆ–"é‡‡é›†æ•°æ®"æŒ‰é’®</div>
        </div>
    </div>
</div>

<style>
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.hotspot-item {
    background: #fff;
    border: 1px solid #e8e8e8;
    border-radius: 8px;
    padding: 20px;
    transition: all 0.3s ease;
}

.hotspot-item:hover {
    border-color: #667eea;
    box-shadow: 0 2px 12px rgba(102, 126, 234, 0.15);
}

.hotspot-item.critical {
    border-left: 4px solid #ff4d4f;
}

.hotspot-item.high {
    border-left: 4px solid #fa8c16;
}

.hotspot-item.medium {
    border-left: 4px solid #faad14;
}

.hotspot-item.low {
    border-left: 4px solid #52c41a;
}

.hotspot-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
}

.hotspot-rank {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: bold;
    margin-right: 15px;
    flex-shrink: 0;
}

.hotspot-info {
    flex: 1;
}

.hotspot-class {
    font-size: 14px;
    color: #999;
    margin-bottom: 5px;
    word-break: break-all;
}

.hotspot-method {
    font-size: 18px;
    font-weight: 600;
    color: #333;
    margin-bottom: 5px;
}

.hotspot-meta {
    display: flex;
    gap: 15px;
    align-items: center;
    flex-wrap: wrap;
}

.hotspot-count {
    background: #f0f5ff;
    color: #597ef7;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 500;
}

.hotspot-type {
    background: #fff7e6;
    color: #fa8c16;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 500;
}

.hotspot-severity {
    display: flex;
    gap: 2px;
    font-size: 14px;
}

.hotspot-suggestion {
    margin-top: 15px;
    padding: 15px;
    background: linear-gradient(135deg, #f6f8ff 0%, #f0f5ff 100%);
    border-radius: 6px;
    border-left: 3px solid #667eea;
}

.hotspot-suggestion-title {
    font-size: 13px;
    color: #667eea;
    font-weight: 600;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.hotspot-suggestion-content {
    font-size: 14px;
    color: #333;
    line-height: 1.6;
}

/* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
.hotspot-content::-webkit-scrollbar {
    width: 8px;
}

.hotspot-content::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.hotspot-content::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 4px;
}

.hotspot-content::-webkit-scrollbar-thumb:hover {
    background: #999;
}
</style>

</body>
</html>
