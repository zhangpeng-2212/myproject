# 🎯 AI热点分析功能 - 前端使用指南

## 功能入口位置

### 主要入口
**文件位置**: `src/main/resources/static/process-monitor.html`

### 访问路径
启动应用后访问：
```
http://localhost:8080/process-monitor.html
```

## 使用步骤

### 步骤1：打开进程管理页面
访问 `http://localhost:8080/process-monitor.html`

### 步骤2：查看进程列表
找到状态为"运行中"的进程

### 步骤3：打开线程监控
1. 点击进程卡片上的"线程监控"按钮
2. 弹出线程监控弹窗

### 步骤4：生成测试数据（可选）
在线程监控弹窗中，点击：
```
📊 生成测试数据
```
系统会自动生成包含各种热点模式的30个线程。

### 步骤5：执行AI热点分析
在线程监控弹窗中，点击：
```
🔍 AI热点分析
```
（紫色渐变按钮）

### 步骤6：查看分析结果
系统会弹出AI热点分析结果弹窗，显示：
- 🎯 **健康评分** (0-100分)
  - 80-100: 良好（绿色）
  - 60-79: 一般（粉色）
  - 0-59: 需关注（红色）

- 📊 **Top 10 热点方法**
  - 排名
  - 类名和方法名
  - 出现次数
  - 问题类型（带颜色标签）
  - 严重级别（⭐评分）
  - 优化建议

## 界面截图示意

```
┌─────────────────────────────────────────────────────────┐
│ 线程监控                           [📊 生成测试数据]  │
│                                             [🔍 AI热点分析] │
│                                              [采集数据] │
└─────────────────────────────────────────────────────────┘
                        ↓ 点击
┌─────────────────────────────────────────────────────────┐
│ 🔍 线程热点AI分析                                    │
│ 检测到10个热点方法，其中3个高优先级问题，2个中优先级  │
│ 问题。健康评分：45分（需关注）                         │
│                                                         │
│  ┌───────────────────────────────────────────────────┐  │
│  │         系统健康评分                             │  │
│  │                                                  │  │
│  │              45                                   │  │
│  │         系统需关注                               │  │
│  └───────────────────────────────────────────────────┘  │
│                                                         │
│  排名  类名              方法     次数   问题    严重度  │
│  ─────────────────────────────────────────────────────  │
│  #1   java.util.HashMap  put      25    并发安全 ⭐⭐⭐⭐⭐ │
│       建议使用ConcurrentHashMap或添加synchronized保护    │
│  ─────────────────────────────────────────────────────  │
│  #2   ThreadPoolExecutor  getTask  20   线程池  ⭐⭐⭐ │
│       线程池等待队列较长，考虑增加核心线程数或优化任务   │
│  ─────────────────────────────────────────────────────  │
│  #3   java.lang.Thread  sleep    15   性能优化  ⭐⭐⭐ │
│       频繁的sleep调用影响响应时间，考虑使用事件驱动或异步│
│  ...                                                   │
└─────────────────────────────────────────────────────────┘
```

## 快速测试命令

### 方式1：使用浏览器界面（推荐）
1. 访问 `http://localhost:8080/process-monitor.html`
2. 点击任意运行中进程的"线程监控"
3. 点击"📊 生成测试数据"
4. 点击"🔍 AI热点分析"

### 方式2：使用API测试
```bash
# 生成测试数据
curl -X POST http://localhost:8080/api/processes/1/threads/collect-hotspot

# 执行分析
curl -X POST http://localhost:8080/api/processes/1/threads/analyze
```

### 方式3：使用浏览器Console
在页面打开浏览器开发者工具(F12)，Console中执行：
```javascript
// 生成测试数据
fetch('/api/processes/1/threads/collect-hotspot', { method: 'POST' })
  .then(r => r.json())
  .then(console.log);

// 执行分析
fetch('/api/processes/1/threads/analyze', { method: 'POST' })
  .then(r => r.json())
  .then(console.log);
```

## 功能特点

✅ **可视化展示** - 彩色图表和评分卡片
✅ **实时分析** - 毫秒级响应
✅ **智能建议** - 针对性的优化建议
✅ **严重分级** - ⭐1-5级严重度评估
✅ **健康评分** - 系统健康度量化评估

## 严重级别说明

| 级别 | 颜色 | 说明 | 建议优先级 |
|------|------|------|-----------|
| ⭐⭐⭐⭐⭐ (5) | 🔴 红色 | 并发安全、死锁风险 | 立即处理 |
| ⭐⭐⭐⭐ (4) | 🟠 橙色 | 锁等待、锁竞争 | 尽快处理 |
| ⭐⭐⭐ (3) | 🟡 黄色 | 线程池、数据库 | 计划处理 |
| ⭐⭐ (2) | 🟢 青色 | IO操作、网络 | 优化处理 |
| ⭐ (1) | ⚫ 灰色 | 常规调用 | 可选优化 |

## 问题类型说明

1. **并发安全** - HashMap、ArrayList等非线程安全集合
2. **锁等待** - Object.wait导致的等待
3. **锁竞争** - ReentrantLock等锁竞争
4. **线程池** - ThreadPoolExecutor配置问题
5. **性能优化** - Thread.sleep等性能问题
6. **IO操作** - 文件、网络IO频繁
7. **数据库** - SQL查询、连接池
8. **HTTP请求** - DispatcherServlet等

## 常见问题

### Q: 点击AI热点分析按钮没有反应？
A: 请确保：
1. 进程状态为"运行中"
2. 已经采集了线程数据（点击"采集数据"或"生成测试数据"）
3. 浏览器Console没有错误信息

### Q: 健康评分很低？
A: 这是正常的！测试数据故意设置了多种热点问题，用于演示功能。真实环境通常不会这么低。

### Q: 如何关闭分析结果弹窗？
A: 点击弹窗右上角的"关闭"按钮即可。

### Q: 分析结果可以导出吗？
A: 目前只显示在页面上，可以截图保存。后续版本会添加导出功能。

## 技术实现

### 前端文件
- **HTML**: `process-monitor.html` (添加了AI分析弹窗)
- **JavaScript**: `process-monitor.js` (添加了分析函数)
- **样式**: `styles.css` (使用了现有样式)

### 后端API
- **POST** `/api/processes/{id}/threads/collect-hotspot` - 生成测试数据
- **POST** `/api/processes/{id}/threads/analyze` - 执行热点分析

### 关键函数
```javascript
// 生成测试数据
generateHotspotTestData()

// 执行AI分析
analyzeHotspots()

// 更新健康评分
updateHealthScore(score)

// 渲染热点表格
renderHotspotTable(hotspots)

// 隐藏弹窗
hideHotspotModal()
```

## 下一步扩展

- [ ] 导出分析报告（PDF/Excel）
- [ ] 历史趋势对比
- [ ] 实时监控和告警
- [ ] 自定义热点规则
- [ ] 集成真实线程dump
- [ ] 图表可视化

---

**开发完成时间**: 2026-02-06
**前端入口**: http://localhost:8080/process-monitor.html
**测试路径**: 进程管理 → 线程监控 → AI热点分析
